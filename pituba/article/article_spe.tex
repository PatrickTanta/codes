% Review
\documentclass[authoryear,preprint,review,10pt]{elsarticle}
%\documentclass[final,authoryear,5p,times,twocolumn,11pt]{elsarticle}

% Review topics:

% % TERMINOLOGY
% % fluid saturations or phase saturations?
% % Block-Oil, Black-oil or black-oil?


%% for a journal layout:
%% \documentclass[final,authoryear,1p,times]{elsarticle}
%% \documentclass[final,authoryear,1p,times,twocolumn]{elsarticle}
%% \documentclass[final,authoryear,3p,times]{elsarticle}
%% \documentclass[final,authoryear,3p,times,twocolumn]{elsarticle}
%% \documentclass[final,authoryear,5p,times]{elsarticle}

% Pending modifications:
% - Add bubble-point pressure to equations after volume and time integration.
% - A different fluid distribution DOES NOT lead to a different value of averaged saturation.
% - CORRECTION: saturations need not be constant in order to Bubble-point pressure be constant.

%\documentclass[final,authoryear,5p,times,twocolumn,11pt]{elsarticle}

\usepackage{lineno}
\usepackage{amsmath}
\usepackage{natbib}
\usepackage{booktabs}
%opening

\newtheorem{prop}{Proposition}
\newtheorem{remark}{Remark}
\newtheorem{step}{Step}


\begin{document}
\begin{frontmatter}
\title{Solution of hydodynamic equilibrium in black-oil reservoirs: the classical material balance equation}
%\title{Obtaining the classical material balance equation from black-oil equations}
%\journal{Journal of Petroleum Science and Engineering}
%\author{R.B. Piccinini}\ead{rbpiccinini@gmail.com}
%\address{Petrobras - UO-BA/ATP-N/RES. Salvador, Bahia, Brazil.}

%
%This work derives the classical material balance equation from the more general black-oil model. It is shown that spatially averaged PVT properties are required for the material balance approach in general, but that for many cases the averaging is simply negligible for practical purposes.  An interpretation for pressure in material balance equation is provided and its relation to a reference depth is examined. The material balance equation is formulated for a varying bubble-point pressure and sufficient conditions for solution uniqueness are presented. A scheme for numerical solution is also proposed.



\begin{abstract}
This work derives the classical material balance equation from a three dimensional black-oil model. Sufficient conditions for solution uniqueness of material balance equation are presented. It is shown that spatially averaged PVT properties are required for reducing a black-oil model to the material balance approach, it is shown, though, that the averaging process may be neglected for many practical purposes.  An interpretation for pressure in material balance equation is provided and its relation to a reference depth is examined. A scheme numerically solve material balance equation for pressure is also proposed.
%
%This work derives the classical material balance equation from a black-oil model. We examine the existing link between both approaches in detail, including the necessary step of averaging PVT properties. An interpretation for pressure in material balance calculations is provided and the choice of a reference depth (datum) is discussed. The material balance equation is formulated for a varying bubble-point pressure and sufficient conditions for solution uniqueness are presented. A scheme for numerical solution is also proposed.
\end{abstract}

\begin{keyword}
material balance \sep black-oil equations \sep reservoir engineering.
\end{keyword}
\end{frontmatter}

\section{Introduction}
Material balance equation is a classical tool in petroleum reservoir engineering. It consists of an algebraic equation originally presented in \cite{schilthuis1936active} and conceived as a zero dimensional model for estimating reservoir pressure from mass balance. \cite{schilthuis1936active} introduced the hypothesis of equilibrium attained at all times not necessarily in the entire reservoir volume, but in the regions of high permeability where most of the production would come from and where pressure would present a similar behavior. Such regions were said to contain an active oil.

As mentioned, the equations developed by \cite{schilthuis1936active} did not account for the non-existence of mechanical, phase or thermal equilibrium. An attempt to introduce non-equilibrium effects of hydrodynamic origin came with \textit{black-oil} equations \citep{aziz1979petroleum,blackoil}. The novelty on hydrodynamics was the introduction of a macroscopic equation of motion using Darcy's law. 

%Black-oil equations arise from the generalization of the zero dimensional concept to a three-dimensional model that incorporates Darcy's law and entails the same approach for phase equilibrium \citep{aziz1979petroleum}.

The term black-oil refers to specific hydrocarbon compositions to which phase equilibrium for isothermal changes in pressure may be described by a two pseudo-component system. For such reservoir fluids, gas phase composition remains essentially constant in the range of pressures observed during production and a pseudo gas component may be defined for a simplified description. A pseudo oil component may also be defined by subtracting the pseudo gas component from oil phase composition. After defining these two pseudo-components, the number of transport equations needed for hydrocarbon species is reduced from a usually large number to only two.

%A general restriction of this approach is that reservoir temperature must be sufficiently below the mixture critical temperature so that different fluid phases have clearly distinguishable properties \citep{danesh1998pvt,firoozabadi1999thermodynamics}.

%Since black-oil and material balance equation differ only on spatial scale and the existence of local pressure gradients, there must exist conditions under which material balance equation might be recovered from the black-oil approach. This work examines such conditions.

A great number of applications of material balance equation have been reported in the literature, but few of them explore its connection with black-oil equations. \cite{ertekin2001basic} briefly addressed this subject arguing both approaches to be equivalent if capillarity and gradients of flow potential ($\nabla \Phi = \nabla p - \rho \vec{g}$) were neglected and if PVT properties were averaged in reservoir volume. The intuitive notion is that material balance equation is obtained if fluid motion is neglected and black-oil equations are integrated in reservoir volume. This work develops this process examining underlying details.

%\begin{subequations}
%\begin{equation}
%p_\alpha = p \, ,
%\end{equation}
%\begin{equation}
%\nabla \Phi_\alpha = \nabla p_\alpha - \rho_\alpha g \nabla z = 0 \, ,
%\end{equation}
%\end{subequations}
%for $\alpha=o,g,w$ referring to oil, gas and water phases.

%It is shown in this work that a stronger assumption is actually needed: mechanical equilibrium in the presence of gravity ($\nabla p = \rho g \nabla z$) is not a sufficient condition, pressure gradients must identically vanish instead ($\nabla p_\alpha \equiv 0$).
%\begin{equation}
%\nabla p \equiv 0 \, .
%\end{equation}

%The restriction of a spatially constant pressure throughout the reservoir does not require PVT properties to be averaged during the integration procedure. Such averaging process is not straightforward, if not impractical, as it is shown later. For the same reason, bubble-point pressure must also be constant and it is shown that this latter assumption is equivalent to having constant fluid saturations in space.

%The requirement of a spatially constant pressure makes the material balance equation more suitable for shallow reservoirs, where gravity field is less important in phase equilibrium.

The same approach of varying bubble-point pressure widely used in reservoir simulation, which is found in \cite{aziz1979petroleum} and \cite{ertekin2001basic}, is also applied to material balance. This approach extends material balance equation to saturated reservoirs under pressure maintenance (e.g. fluid injection). The applicability, however, depends on how important are non-equilibrium effects to phase equilibrium.

%It has already been shown the importance of not having strong flow near interface that prevents mixing and causes pressure to drop locally \citep{steffensen1973reservoir,utseth1981numerical}.

After presenting material balance equation, sufficient conditions are shown for which material balance equation has only one solution for pressure. These conditions require fluids to be compressible and that gas dissolution occurs with reduction of the overall system volume. A simple scheme for numerical solution is also proposed based on classical root-finding algorithms for non-linear equations.

%\section{Black-oil equations}
%
%Here it is used a thermodynamic fluid model known as Black-Oil \cite{blackoil}. It consists of a simplified treatment of hydrocarbon composition and phase equilibrium. Hydrocarbon species are grouped into two pseudo-components called oil and gas, being a pseudo-component one which consists of more than one chemical molecule.
%
%Oil is composed by hydrocarbon species that remain in liquid phase for standard surface pressure and temperature. The other hydrocarbon species in gaseous phase for the same surface conditions are called gas.
%
%The mixture of reservoir fluid is then composed of oil, gas and water components and can present three fluid phases: oil, gas and water. Oil phase may be composed of oil and gas components, gaseous phase may be composed uniquely by gas component and water phase uniquely by water component.
%
%In addition to the three fluid components and phases, there is a solid phase composed by the rock.
%
%The fluid phases may be defined in a more general framework so as to account for dissolution of gas in water or water vapour, for instance. Such possibilities are not dealt with in this work.
%
%For some volume containing one of the three fluid phases, the saturation of the fluid phase $k$ is defined as
%\begin{equation}\label{eq: saturation}
%S_{k}=\frac{\phi_k}{\sum_{i \neq solid} \phi_i} \, ,
%\end{equation}
%where $\phi_i$ is the volume fraction of the fluid phase $i$.
%
%In order to apply the volume balance, a control volume ($\Omega$) is defined containing all the hydrocarbon zone. It consists of the region where hydrocarbon saturation is greater than zero for some arbitrarily small volume. This reservoir definition excludes the pure water zone, which is referred to as the aquifer.
%
%
%Right hand side of Equation \eqref{eq: matbal1}, \textit{rock and fluid expansion}, is a function of phase mass transfers and compressibilities. Both should be obtained from a thermodynamic model accounting for mass transfer among phases and the relation between phase volumes and pressure. Temperature is seldom considered to vary during reservoir production and it is held constant and equal in all phases, not being an independent property of the control volume state.
%
%Such thermodynamic model is presented in detail in \cite{blackoil} and it is commonly referred to as Black-Oil Equations. The main assumption behind them is that phase and pressure equilibria are instantaneously achieved inside the control volume, i.e., mass transfer among phases reaches equilibrium and internal forces equilibrate external ones fast enough in comparison to the interval of time between two observations of control volume properties.
%
%Pressure in each phase may differ if capillary forces are taken into account, for what extra constitutive equations relating each phase pressures would be needed.
%Capillary pressure would be function of porous medium properties given by some porous medium model, e.g., permeability and porosity; phase properties, e.g., surface tension and wettability, and the thermodynamic state.
%
%Capillary pressure is very often assumed to be function of phase saturations only and, hence, the thermodynamic state of the control volume would be completely determined by the pressure of one phase (e.g. the wetting phase) and phase saturations.
%
%Black-Oil Equations do not assume water and oil phases becoming miscible for any thermodynamic state.
%
%Capillary pressure dependence on phase saturation only is often considered as a weak assumption in contradiction with experimental observations. The hysteresis of capillary pressure exhibited when either imbibition or drainage occurs is not theoretically explained and it is accounted for by empirical relations or it is rather simply neglected.
%
%\cite{hilfer1} has proposed the inclusion of an energy equation.

\section{Derivation of equations}

This section starts presenting black-oil equations and it proceeds averaging quantities in space and examining simplifying assumptions for which material balance equation is obtained.

\subsection{Black-oil equations}

% As already mentioned, black-oil is a designation to a simplified treatment of hydrocarbon composition and phase equilibrium. Hydrocarbon species are grouped into two pseudo-components called oil and gas, being a pseudo-component one that consists of more than one chemical molecule.

% Oil component, also called stock tank oil, is defined as the hydrocarbon composition in liquid phase for standard surface pressure and temperature. Similarly, gas component is the hydrocarbon composition in gaseous phase for the same surface conditions. All species are generally present in both phases although the equilibrium composition is shifted to liquid phase (or gaseous phase) for components of greater (lower) molecular mass.

Reservoir fluids are composed of oil and gas pseudo-components and water component. There can be three fluid phases: oil, gas and liquid water. Oil phase may be composed of oil and gas components, gas phase may be composed uniquely by gas component and, water phase, uniquely by water component. The only allowed mass transfer is of gas component between oil and gas phases.

In addition to the three fluid components and phases, there is the solid phase composed by the rock.

Mass balance equations for each component are:

\begin{itemize}
\item water component:
\begin{equation}\label{eq: Sw1}
\frac{\partial}{\partial t} \int\limits_{\Omega} \rho_w S_w \phi dV + \oint_{\partial \Omega} \rho_w \left( \vec{u}_w \cdot \vec{dS} \right) = \rho_w^{ST}Q_w^{ST} \, ;
\end{equation}

\item oil component:
\begin{equation}\label{eq: So1}
\frac{\partial}{\partial t} \int\limits_{\Omega} \rho_o Y_o S_o \phi dV + \oint_{\partial \Omega} \rho_o Y_o \left(\vec{u}_o \cdot \vec{dS} \right)= \rho_o^{ST}Q_o^{ST} \, ;
\end{equation}

\item gas component:
\begin{equation}\label{eq: Sg1}
\frac{\partial}{\partial t} \int\limits_{\Omega} \left( \rho_o Y_g S_o + \rho_g S_g\right) \phi dV + \oint_{\partial \Omega} \left( \rho_o Y_g \vec{u}_o + \rho_g \vec{u}_g\right) \cdot \vec{dS}= \rho_g^{ST}Q_g^{ST} \, .
\end{equation}
\end{itemize}
Mass concentration of oil and gas components in oil phases are denoted as $Y_o$ and $Y_g$, respectively.

Phase saturation is defined as its volumetric fraction of the pore space:
\begin{equation}
S_\alpha = \frac{\phi_\alpha}{\phi} \, ,
\end{equation}
where $\phi_\alpha$ is the volumetric fraction of a fluid phase $\alpha$ and $\phi$ is the porosity.
\begin{equation}
S_o + S_g +S_w = 1 \, .
\end{equation}

A common simplification in black-oil formulations is to restrict mass transport to macroscopic advection. No diffusive or dispersive term is included in the mass balance equations. 

%This simplification must be looked with care when gradients of species concentration are important. For instance, when gas is being dissolved in oil phase in a reservoir under repressurization, this condition is not generally true.

%and $\nabla Y_i \approx 0$ does not hold for some species $i$. For instance, when gas is being dissolved in oil phase in a reservoir under repressurization, this condition is not generally true.

%Mass balance equations for each fluid phase are \citep{ertekin2001basic}:
%% Oleo
%\begin{equation}\label{eq: So1}
%\frac{\partial}{\partial t}\left(\frac{\phi(p_P) S_o}{B_o(p_o,P_b)}\right)+\nabla\cdot\left(\frac{\vec{u}_o}{B_o (p_o,P_b)}\right)=q_{os} \, ,
%\end{equation}
%% Gas
%\begin{equation}
%\begin{split}\label{eq: Sg1}
%\frac{\partial}{\partial t}\left[\phi(p_P)\left(\frac{S_g}{B_g (p_g)} +\frac{S_o R_s (p_o,P_b)}{B_o (p_o,P_b)}\right)\right] \\
%+\nabla\cdot\left(\frac{\vec{u}_o R_s (p_o,P_b)}{B_o (p_o,P_b)}+\frac{\vec{u}_g}{B_g (p_g)}\right)=q_{gs} \, ,
%\end{split}
%\end{equation}
%% Agua
%\begin{equation}\label{eq: Sw1}
%\frac{\partial}{\partial t}\left(\frac{\phi (p_P) S_w}{B_w (p_w)}\right)+\nabla\cdot\left(\frac{\vec{u}_w}{B_w(p_w)}\right)=q_{ws} \, ,
%\end{equation}
%
%where saturations must satisfy the constraint
%\begin{equation}\label{eq: S11}
%S_o+S_w+S_g=1 \, .
%\end{equation}
%
%Bubble-point pressure ($P_b$) is here defined as the minimum pressure for which gas phase is locally absent, i.e., $S_g=0$. Its local value is implicitly given by the solubility ratio ($R_s$) satisfying the equation:
%\begin{equation}\label{eq: Pb}
%R_s(p_o=P_b,P_b) = \frac{B_g(p_g)}{B_o(p_o,P_b)}\frac{S_g}{S_o} +R_s(p_o,P_b) \, .
%\end{equation}
%It must be remarked that bubble-point pressure is sometimes defined in a different manner as the bubble-point pressure for the hydrocarbon composition in oil phase only. According to this latter definition, $P_b = p_o$ for any saturated reservoir.
%
%Black-oil equations make the assumption of instantaneous mass transfer between oil and gas phases, what is only reasonable for a reservoir under depletion, when oil and gas components are homonegeously distributed in oil phase. Once constant temperature and fluid composition are assumed, diffusion and advection of species and energy become unimportante for phase equilibrium calculations.
%
%If gradients of species concentration are present within oil phase, however, as it occurs in saturated reservoirs under pressure maintenance, a combined mechanism of advection and diffusion exists and those are absent of black-oil equations. Some heuristic models have been proposed for problems where this issue is critical, as for gas injection projects. \cite{utseth1981numerical} has proposed to limit $dR_s/dt$ and neglect transport of gas component in oil phase for a simplified treatment.

Momentum balance for each phase is given by an extension of Darcy's law to multiphase flow. This extension consists in multiplying absolute (or single-phase) permeability ($\vec{\vec{k}}$) by a scalar function called phase relative permeability ($k_{r,\alpha}$):

\begin{equation}\label{eq: exdarcy}
\vec{u}_\alpha = -\frac{k_{r,\alpha} \vec{\vec{k}}}{\mu_\alpha} \left(\nabla p_\alpha - \rho_\alpha g\nabla z\right) \, , \quad \alpha=o,w,g \, .
\end{equation}

Phase densities are functions of the local thermodynamic state:
\begin{equation}
\rho_w = \rho_w \left(p_w, T_w\right)
\end{equation}
\begin{equation}
\rho_o = \rho_o \left(p_o, T_o,Y_g\right)
\end{equation}
\begin{equation}
\rho_g = \rho_g \left(p_g, T_g\right)
\end{equation}

Another simplification is now made assuming thermal equilibrium in the entire reservoir volume:
\begin{equation}
T_w = T_o = T_g = T_{rock} = T
\end{equation}
and
\begin{equation}
\nabla T \equiv 0 \, .
\end{equation}

Temperature is thus a constant prescribed value and no energy balance equation is needed. It follows from Gibbs' phase rule that the equilibrium of oil and gas phases has only two degrees of freedom if we restrict component number to the two pseudo-components. As temperature is assumed constant, oil phase density in saturated states may be a function of pressure alone. The same is valid for mass fractions of gas and oil components in oil phase.

\begin{equation}
Y_g = Y_g (p_o) \, ,
\end{equation}
\begin{equation}
Y_o = Y_o (p_o) \, .
\end{equation}

Porosity ($\phi$) is assumed a function of pore pressure ($p_P$). Because three phases are present in general, such quantity is defined by some relation of type \citep{kim2011rigorous}:
\begin{equation}
p_P=p_P\left(p_o,p_w,p_g,S_o,S_w,S_g\right) \, .
\end{equation}

To close the system of equations, a connection among different phase pressures is provided by capillary pressure relations:
%capillary
\begin{equation}\label{eq: capillary_ow}
p_{c,ow}\left(\vec{\vec{k}},\phi,S_w\right)=p_o-p_w \, ,
\end{equation}
\begin{equation}\label{eq: capillary_og}
p_{c,go}\left(\vec{\vec{k}},\phi,S_g\right)=p_g-p_o \, .
\end{equation}


%Capillary pressure and relative permeability are controversial concepts in the sense that they have not been demonstrated to arise from theoretical foundations. For practical applications, both functions are usually assumed in the forms presented above and their properties are argued to be empirically established.

%It is well known that black-oil equations possess discontinuous solutions in saturation, bubble pressure and solubility ratio fields. Discontinuities (or shocks) are introduced by initial or boundary conditions and are propagated throughout flow domain due to the hyperbolicity of equations.
%
%In initial conditions, if hydrostatic equilibrium is imposed and no capillary pressure is included, that is,
%\begin{equation}
%p_{c,ow}=p_{c,og}=0 \quad \longrightarrow \quad p_o=p_w=p_g=p\, ,
%\end{equation}
%saturation discontinuities will be present due to gravity segregation.
%
%When capillary pressure is present and it is function of phase saturations, a diffusive term is introduced in mass balance equations and shocks originated by phase displacement become smoothed:
%\begin{equation}
%\frac{\partial}{\partial t}\left(\frac{\phi (p_P) S_w}{B_w (p_w)}\right)-\nabla\cdot\left[\frac{k_{r,w} \vec{\vec{k}}}{B_w(p_w)\mu_w} \left(\nabla p_o - \rho_w g\nabla z -\underbrace{\frac{d p_c}{d S_w}\nabla S_w}_{\text{water diffusion}}\right)\right]=q_{ws} \, .
%\end{equation}
%
%Discontinuities in saturation may still occur, however, if capillary pressures are functions of discontinuous porous medium properties ($phi$ and $\vec{\vec{k}}$) or if phase change takes place, as diffusion of gas dissolved in oil phase is not allowed.
%Cite Bear and Herrera.


\subsection{Material balance equation}

Derivation of the material balance equation consists in assuming no fluid motion and in integrating black-oil equations in reservoir volume. As it will be shown, the integration process requires all quantities to be either spatially averaged or assumed constant.

%Defining averages of most quantities is difficulty, though, as they appear in equations as products of up to three factors. Being the quantities self-correlated, the averaging process would involve unclosed terms. Quantities are thus required to be spatially constant wherever needed.

%A second problem is that averaging requires the knowledge of a spatial distribution of quantities for it be uniquely specified, as it can be seen for an average saturation depending on spatial distributions of local saturation and porosity,
%\begin{equation}\label{eq: avS}
%\bar{S}_\alpha = \int_\Omega S_\alpha \phi dV \, .
%\end{equation}


We start assuming mechanical equilibrium, i.e., no bulk motion:
\begin{equation}
\vec{u}_\alpha = -\frac{k_{r,\alpha} \vec{\vec{k}}}{\mu_\alpha} \left(\nabla p_\alpha - \rho_\alpha g\nabla z\right)\equiv 0 \, .
\end{equation}
This condition implies that pressure gradients must equal gravity force per unit volume:
\begin{equation}\label{eq: p=rhogh}
\nabla p_\alpha = \rho_\alpha g\nabla z
\end{equation}
and, consequently, pressure is a function of depth only:
\begin{equation}\label{eq: p=rhogh}
\int_{p_\alpha^0}^{p_\alpha} \frac{dp_\alpha^{'}}{\rho_\alpha \left(p_\alpha^{'},T\right)} = g\left(z - z_0\right) \, .
\end{equation}

Black-oil equations become:
\begin{itemize}
\item water component:
\begin{equation}\label{eq: Sw2}
\frac{\partial}{\partial t} \int\limits_{\Omega} \rho_w S_w \phi dV = \rho_w^{ST}Q_w^{ST} \, ;
\end{equation}

\item oil component:
\begin{equation}\label{eq: So2}
\frac{\partial}{\partial t} \int\limits_{\Omega} \rho_o Y_o S_o \phi dV = \rho_o^{ST}Q_o^{ST} \, ;
\end{equation}

\item gas component:
\begin{equation}\label{eq: Sg2}
\frac{\partial}{\partial t} \int\limits_{\Omega} \left( \rho_o Y_g S_o + \rho_g S_g\right) \phi dV = \rho_g^{ST}Q_g^{ST} \, .
\end{equation}
\end{itemize}
%
\subsubsection{Averaging quantities}

Spatially averaged quantities are defined for porosity ($\phi$), saturation ($S_\alpha$), density ($\rho_\alpha$) and mass concentration ($Y_{\alpha,k}$) of a component $k$ in phase $\alpha$.

All quantities are initially functions of space and time and they become functions only of time after being averaged in space:

\begin{equation}
\bar{\phi} (t) = \frac{1}{\Omega}\int_{\Omega}\phi \left(\vec{x},t\right) dV \, .
\end{equation}

Omitting function arguments:
\begin{equation}
\bar{S}_\alpha\bar{\phi} = \frac{1}{\Omega}\int_{\Omega}S_\alpha \phi dV \, ,
\end{equation}

\begin{equation}
\bar{\rho_\alpha}\bar{S}_\alpha \bar{\phi} = \frac{1}{\Omega}\int_{\Omega}\rho_\alpha S_\alpha \phi dV \, ,
\end{equation}

\begin{equation}
\bar{\rho}_\alpha \bar{Y}_{\alpha,k}\bar{S}_\alpha \bar{\phi} = \frac{1}{\Omega}\int_{\Omega}\rho_\alpha Y_{\alpha,k} S_\alpha \phi dV \, .
\end{equation}

Eqs. \eqref{eq: Sw2}, \eqref{eq: So2} and \eqref{eq: Sg2} are rewritten in terms of averaged quantities:

\begin{itemize}
\item water component:
\begin{equation}\label{eq: Sw3}
\frac{\partial}{\partial t} \left( \bar{\rho_w}\bar{S}_w\bar{\phi} \Omega \right) = \rho_w^{ST}Q_w^{ST}
\end{equation}

\item oil component:
\begin{equation}\label{eq: So3}
\frac{\partial}{\partial t} \left( \bar{\rho_o}\bar{Y}_o\bar{S}_o\bar{\phi} \Omega \right) = \rho_o^{ST}Q_o^{ST}
\end{equation}

\item gas component:
\begin{equation}\label{eq: Sg3}
\frac{\partial}{\partial t} \left[\left( \bar{\rho}_o\bar{Y}_g \bar{S}_o + \bar{\rho}_g \bar{S}_g \right) \bar{\phi} \Omega\right] = \rho_g^{ST}Q_g^{ST} \, .
\end{equation}
\end{itemize}

We now introduce usual definitions from petroleum engineering for the description of volumetric and solubility changes in fluid phases. In what concerns volumetric changes, $B_w$, $B_o$ and $B_g$, the formation volume factors of water, oil and gas phases, respectively, express the ratio of a phase volume at some given pressure and temperature condition to the volume of the same phase at standard pressure and temperature, i.e.:

\begin{equation}\label{eq: Bw}
B_w = \frac{\rho_w^{ST}}{\bar{\rho}_w} \, ,
\end{equation}

\begin{equation}\label{eq: Bo}
B_o = \frac{\rho_o^{ST}}{\bar{Y}_o \bar{\rho}_o} \, ,
\end{equation}

\begin{equation}\label{eq: Bg}
B_g = \frac{\rho_g^{ST}}{\bar{\rho}_g} \, .
\end{equation}

In what concerns changes in gas solubility in oil phase, the solubility ratio ($R_s$) gives the ratio between volumes of dissolved gas and oil both measured in standard condition:

\begin{equation}
R_s = \frac{\rho_o^{ST} / \bar{Y}_o}{\rho_g^{ST} / \bar{Y}_g} \, ,
\end{equation}

or using $\bar{Y}_o + \bar{Y}_g = 1$:
\begin{equation}
R_s = \frac{\rho_o^{ST}}{\rho_g^{ST}}\frac{\bar{Y}_g}{1-\bar{Y}_g} \, .
\end{equation}

Equations may now be rewritten using the above definitions and denoting porous volume by $V_p = \bar{\phi}\Omega$.

\begin{equation}\label{eq: Sw4}
\frac{\partial}{\partial t} \left(\frac{\bar{S}_w V_p}{B_w} \right) = Q_w^{ST} \, ,
\end{equation}

\begin{equation}\label{eq: So4}
\frac{\partial}{\partial t} \left(\frac{\bar{S}_o V_p}{B_o} \right) = Q_o^{ST} \, ,
\end{equation}

\begin{equation}\label{eq: Sg4}
\frac{\partial}{\partial t} \left[ V_p \left(\frac{\bar{S}_g}{B_g} + \frac{\bar{S}_o R_s}{B_o} \right) \right] = Q_g^{ST} \, ,
\end{equation}

\begin{equation}\label{eq: S14}
\bar{S}_w+\bar{S}_o+\bar{S}_g=1 \, .
\end{equation}

Integrating Eqs.~\eqref{eq: Sw4}, \eqref{eq: So4} and \eqref{eq: Sg4} between times $t_1$ and $t_2$ gives:
% Water
\begin{equation}\label{eq: Sw5}
\frac{V_{p2} \bar{S}_{w2}}{B_{w2}}=W+\left(W_i+W_e-W_p\right) \, ,
\end{equation}

% Oil
\begin{equation}\label{eq: So5}
\frac{\bar{S}_{o2} V_{p2}}{B_{o2}} = N-N_p \, ,
\end{equation}

% Gas
\begin{equation}\label{eq: Sg5}
V_{p2}\left(\frac{\bar{S}_{g2}}{B_{g2}} +\frac{\bar{S}_{o2} R_{s2}}{B_{o2}}\right) = N\left(m\frac{B_{o1}}{B_{g1}} + R_{s1}\right) +\left(G_i-G_p\right) \, ,
\end{equation}
%
\begin{equation}\label{eq: S15}
\bar{S}_o+\bar{S}_w+\bar{S}_g=1 \, .
\end{equation}

Where $N=V_{p1} \bar{S}_{o1}/B_{o1}$ and $W=V_{p1} \bar{S}_{w1}/B_{w1}$ are the initial volumes of oil and water measured at standard conditions and $m=V_{p1} \bar{S}_{g1}/B_{o1} N$ is the ratio of the initial volumes of gas and oil phases measured in reservoir conditions.

An equation for bubble-point may be obtained by setting $S_g=0$ in Eq.~\eqref{eq: Sg5} and solving it for the solubility ratio at bubble-point pressure $R_s(p=P_b)$:
\begin{equation}
\begin{split}
R_{s2}\left(p=P_b\right) = &\Big[N\left(m B_{1}/B_{g1} +R_{s1}\right)\\
&+G_i-G_p\Big]/\left(N-N_p\right) \, .
\end{split}
\end{equation}

\subsubsection{Material balance equation}

It is now possible to obtain the classical material balance equation substituting the equations for phase saturation, Eqs.~\eqref{eq: Sw5}, \eqref{eq: So5} and \eqref{eq: Sg5}, into Eq.~\eqref{eq: S15}:  

\begin{equation}\label{eq: MBE}
F_p - F_i= \underbrace{N E_o + mN E_g + W E_w}_{\text{fluid volume expansion } (E)} +\underbrace{V_{p1}-V_{p2}}_{\text{porous volume contraction } (C)}
\end{equation}
or
\begin{equation}\label{eq: MBE_short}
F_p - F_i= E + C \, ,
\end{equation}
where new terms $C$, $E$, $F_i$ and $F_p$ are defined in Table~\ref{tab: MBE}. 

Eq~\eqref{eq: MBE} only involves fluid properties, original fluid volumes ($N$, $W$ and $G)$ and cumulative production and injection.
It is an agelbraic equation that may be solved to any of its terms provided all remaining are known. Several techniques exist in the literature to estimate original volume of fluids, water influx from aquifers or reservoir pressure. 

\subsubsection{Definition of a reference depth for pressure}

Material balance equation is widely used to stablish a relationship between production (and injection) and reservoir pressure. In Eq.~\eqref{eq: MBE}, however, formation volume factors were defined using averaged values of fluid properties,  which depend on pressure. It turns out, though, that pressure is a function of depth and phase. 

% ERRADO: Using the average reservoir pressure ($\bar{p}$) to compute fluid properties does not solve this issue because $\bar{\rho}_o$ is not equal to $\rho_o (\bar{p})$ and thus $B_o$ is not a simple function of $p$.

What is then the meaning of pressure calculations in material balance equations?

For answering this question, we examine the two roles played by pressure in material balance equation: computation of phase density and phase equilibrium. 

We shall see that to compute the averaged phase density, we may define some reference depth and use the corresponding local density as an approximation to the averaged density without introducing any important error. 

Pressure increases with depth according to the hydrostatic gradient. Consequently, density also increases but by a negligible amount. This approximation may be quantified by putting together the expressions for compressibility and hydrostatic equilibrium. For this, we assume a constant isothermal compressibility for oil phase
\begin{equation}\label{eq: grado}
\left( \frac{1}{\rho_o}\frac{\partial \rho_o}{\partial p_o} \right)_{T,Y_o} = c_o 
\end{equation}
and we use hydrostatic equilibrium $dp_o = \rho_o g dz$ to obtain the expression for the derivative of oil density with depth:
\begin{equation}
\left( \frac{1}{\rho_o}\frac{\partial \rho_o}{\partial z} \right)_{T,Y_o} = c_o \rho_o g \, .
\end{equation}

Similarly for the gas phase, we obtain its isothermal compressibility from the gas state equation
\begin{equation}
\left(\frac{1}{\rho_g}\frac{\partial \rho_g}{\partial p_g}\right)_{T,Z} = \frac{1}{p_g} = \frac{\mathcal{M}}{\rho_g ZRT}
\end{equation}
and again we use hydrostatic equilibrium to obtain the derivative of gas density with depth:
\begin{equation}\label{eq: gradg}
\left(\frac{1}{\rho_g}\frac{\partial \rho_g}{\partial z}\right)_{T,Z} = \left(\frac{\mathcal{M}}{ Z R T}\right) g \, .
\end{equation}


Substituting typical values in Eqs.~\eqref{eq: grado} and \eqref{eq: gradg}, we see that oil and gas densities are rather constant with depth:
\begin{equation}
\left(\frac{1}{\rho_o}\frac{\partial \rho_o}{\partial z}\right)_{T,Y_o} \approx 10^{-6}\ m^{-1} \, ,
\end{equation}

\begin{equation}
\left(\frac{1}{\rho_g}\frac{\partial \rho_g}{\partial z}\right)_{T,Z} \approx 10^{-5}\ m^{-1} \, .
\end{equation}

The reference depth for computing phase density (or formation volume factors) is then any arbitrary depth inside phase volume. For a negligible variation of density with depth, it is easily seen that $\bar{\rho} = \rho\left(\bar{p}\right)$ and $\bar{p}=p\left(z^0\right)$ where $z^0$ is the depth of phase gravity center.

For the case of an oil reservoir covered by a gas cap, the reference depth may be defined, with advantage, at the gas-oil contact. The point here is that at phase contact both gas and oil densities may be computed using the same pressure, i.e., the corresponding local value (we are neglecting capillary pressure). 

If the reference depth for oil phase is otherwise defined below gas-oil contact, gas density must be computed at some different depth still inside gas phase, i.e., at or above gas-oil contact. This is to avoid the effect of oil hydrostatic gradient in the computation of gas density,
\begin{equation}
\left(\frac{1}{\rho_g}\frac{\partial \rho_g}{\partial z}\right)_{T,Z} = \frac{\rho_o}{\rho_g}\left(\frac{\mathcal{M}}{Z R T}\right)g  \, ,
\end{equation}
what is $\rho_o / \rho_g$ times greater than the sole effect of gas hydrostatic pressure on its density.

It has been shown that pressure variation with depth is not important for the computation of gas, oil and water densities. Nevertheless, it was said that pressure also plays a second role in material balance equation by defining phase equilibrium. For this purpose, pressure variation with depth may not be negligible in the evalutation of the solubility ratio: 
\begin{equation}\label{eq: dRsdz1}
\frac{1}{R_s}\frac{d R_s}{dz} = \frac{1}{R_s}\frac{d R_s}{dp_o} \frac{dp_o}{dz} = \frac{\rho_o g}{R_s}\frac{dR_s}{dp_o} \, .
\end{equation}

For a non-volatile saturated oil, we may approximate $dR_s / dp_o$ to the ratio between  solubility ratio ($R_{s}$) and saturation pressure ($p_{sat}$), so that Eq.~\eqref{eq: dRsdz1} becomes:
\begin{equation}\label{eq: dRsdz2}
\frac{1}{R_s}\frac{d R_s}{dz} \approx \frac{\rho_o g }{p_{sat}} \approx 10^{-3}\ m^{-1} \, ,
\end{equation}
where the following orders of magnitudes were assumed: $p_{sat} \approx 10^{7}\ Pa$, $\rho_o \approx 10^{3}\ kg/m^3$ and $g \approx 10\ m^2/s$. 

From Eq.~\eqref{eq: dRsdz2}, we see that the variation of pressure with depth may not be negligible for the phase equilibrium,  specially for thick reservoirs of light oil. In such cases, using an averaged value for the solubility ratio may be worth the accuracy gain in computing dissolved gas volume.

% \subsubsection{Material balance as an equation for reservoir pressure}

%Equations from \eqref{eq: Sw4} to \eqref{eq: S14} constitute the most general form of material balance equation. So far, the only simplification made to black-oil equations was the absence of fluid motion, allowing pressure to be computed from Eqs.\eqref{eq: capillary_ow}, \eqref{eq: capillary_og} and \eqref{eq: p=rhogh}, and equations to be integrated in the entire reservoir volume.

%We now look to solve Eqs. \eqref{eq: Sw5}, \eqref{eq: So5} and \eqref{eq: Sg5} for the averaged quantities. 

%A single equation for pressure may be obtained by substituting Eqs.~\eqref{eq: So5}, \eqref{eq: Sg5} and \eqref{eq: Sw5} into \eqref{eq: S15}. The resulting equation allows pressure to be calculated from given production ($F_p$) and injection ($F_i$) volumes:
%\begin{equation}\label{eq: MBE}
%F_p - F_i= \underbrace{N E_o + mN E_g + W E_w}_{\text{fluid volume expansion } (E)} +\underbrace{V_{p1}-V_{p2}}_{\text{porous volume contraction } (C)}
%\end{equation}
%or
%\begin{equation}\label{eq: MBE_short}
%F_p - F_i= E + C \, ,
%\end{equation}

%where newly introduced terms are defined in Table~\ref{tab: MBE}. Eq.~\eqref{eq: MBE} is commonly referred to as the Material Balance Equation (MBE).

\section{Solution of material balance equation}
A numerical solution of Eq.~\eqref{eq: MBE_short} is presented here. We shall start defining a residual function ($\varepsilon$) for which the pressure solving Eq.~\eqref{eq: MBE_short} is a root:
\begin{equation}\label{eq: residual}
\varepsilon(p_2) = \frac{E+F_i+C-F_p}{V_{p1}} \, .
\end{equation}
We proceed showing that $\varepsilon$ is a monotonic function provided some conditions on fluid properties are observed and that, as a consequence, only one root of $\varepsilon$ exists at most. Equivalently, we may say that only one solution exists for material balance equation.

%The conditions imposed on fluid PVT properties are the mathematical equivalent of requiring a far from critical thermodynamic state.

\subsection{Mathematical aspects of the residual function}

It is a known result of real analysis that a monotonic function $f:D\subset\mathcal{R}\rightarrow\mathcal{R}$ can have at most one root in $D$. Further, if $f$ is continuous in the closed interval $I=[a,b] \subset D$ and $f(a)f(b)<0$, then $f$ has one (and only one) root in $I$.

We now state without proof that the following affirmatives are sufficient conditions to classify a function $f$ as monotonic:
%We now show that $\varepsilon$ is a monotonic function since it is:
\begin{enumerate}
\item $f$ is continuous;
\item $f$ is differentiable everywhere except for a countable set of points;
\item $f'<0$ everywhere.
\end{enumerate}

Residual function clearly satisfies the first two affirmatives because fluid properties are continuous everywhere and are also differentiable everywhere except for the first order phase change at bubble-point pressure.
The third affirmative is proved by rewriting $d\epsilon/dp$ as a sum of four parcels corresponding each one to a different phase. Each parcel is composed of two factors: current volume \textit{in-situ} and volume derivative with respect to pressure:
\begin{equation}
\begin{split}
&V_{p1}\frac{d\varepsilon}{dp}=\underbrace{\left(N-N_p\right) \left(\frac{dB_o}{dp} - B_g \frac{dR_s}{dp} \right)}_\text{oil phase}\\
&+\underbrace{\left[N R_{s1}+mN\frac{B_{o1}}{B_{g1}}+G_i-\left(N-N_p\right)R_{s2}-G_p\right] \frac{dB_g}{dp}}_\text{gas phase}\\
&+\underbrace{\left(W + W_i+W_e-W_p\right)\frac{dB_w}{dp}}_\text{water phase}\\
&\underbrace{-\frac{dV_p}{dp}}_\text{porous volume}\, .
\end{split}
\end{equation}

\textit{In-situ} volumes (e.g. $N-N_p$ for oil phase) are non-negative values. Pressure derivatives of fluid volumes are non-positive values (fluid volume cannot increase as pressure increases) and pressure derivative of porous volume is a positive value (as fluid pressure increases, porous volume expands owing to rock compression).

The value of $d\varepsilon/dp$ is thus negative if at least one phase is compressible because it would be a sum of products between negative and positive factors.

In summary, the following four relations constitute sufficient conditions for $\varepsilon(p)$ be a strictly decreasing function and, therefore, for material balance equation to have only one solution:
\begin{equation}\label{eq: PVTH1}
\left(\frac{dB_o}{dp} - B_g \frac{dR_s}{dp} \right) \leq 0 \, ,
\end{equation}
\begin{equation}\label{eq: PVTH2}
\frac{dB_g}{dp} \leq 0 \, ,
\end{equation}
\begin{equation}\label{eq: PVTH3}
\frac{dB_w}{dp} \leq 0 \, ,
\end{equation}
\begin{equation}\label{eq: PVTH4}
\frac{dV_p}{dp} \geq 0 \, .
\end{equation}

Above relations, specially Eq.~\eqref{eq: PVTH1}, provide a test to check whether PVT data obtained from laboratory or empirical correlations is physically correct.

%Switching inequalities to equalities in Eqs.~\eqref{eq: PVTH1}, \eqref{eq: PVTH2} and \eqref{eq: PVTH3} is equivalent to enforcing system incompressibility. Eq.~\eqref{eq: PVTH1}, for instance, would require a volume increase in oil phase to be equal to gas volume in gas phase for any additional gas dissolution.

\subsection{Solution algorithm}
Several methods exist to find roots of nonlinear continuous functions \citep{hamming1987numerical}. One possible choice is Newton's method, which linearizes the function using either its gradient or a secant line. The secant line approach introduces an artificial smoothness to the gradient direction near continuous but non-differentiable points, for what it is the approach used here to deal with the bubble-point pressure.

An open source implementation of secant method is available in SciPy library \citep{scipy}. This work used library version $0.12$.

%A more simple and robust option is the bisection method, which does not require the function to be differentiable anywhere. The number of iterations $n$ required to reduce search interval by a factor of $\delta$ is \citep{hamming1987numerical}:
%\begin{equation}
%n=\log_{2} (\delta)+1 \, .
%\end{equation}

%If the inital search interval is $[a;b]$, an error tolerance $|p^{n}-p^{n-1}|\leq (b-a)/\delta $ can be achieved in $21$ iterations for $\delta=10^{6}$.

%Either methods were successfully employed to obtain solution of equations.

The steps to solve all material balance equation are summarized bellow:
\begin{step}
Compute bubble-point pressure for instant $t_2$.
\end{step}

Bubble-point pressure $P_{b2}$ is only a function of the values in initial instant $t_1$ and produced and injected volumes.

\begin{step}
Compute fluid pressure for instant $t_2$ finding the root of residual function ($\varepsilon$).
\end{step}

Pressure in Eq.~\eqref{eq: MBE} is a function only of fluid properties in instant $t_1$, produced and injected values and bubble-point pressure at instant $t_2$, $P_{b2}$, which was already computed in step 1.

\begin{step}
Compute fluid saturations $t_2$.
\end{step}

Once $S_{o2}$, $S_{g2}$, $S_{w2}$, $p_2$ and $P_{b2}$ are known, solution for instant $t_2$ is complete.

\section{Results}
Material balance equation were solved for a black-oil reservoir initially producing in depletion drive mechanism and later subjected to water injection. Fig.~\ref{fig: matbal_p} shows in the solid line curve the severe depletion during initial phases of production. In the dashed curve, Fig.~\ref{fig: matbal_p} shows the bubble-point pressure, indicating how far the saturated reservoir is from undersaturation and allowing for planning of pressure maintenance projects.


Water injection starts when oil recovery factor $(RF)$ is about $RF=0.08$ and it is maintained until the reservoir reaches a novel undersaturated state. Initially, the high compressibility of gas prevents pressure from raising and free gas phase is reduced because of redissolution. Finally, the reservoir reaches the undersaturated state and a steep pressure increase is seen in Fig.~\ref{fig: matbal_p} for a recovery factor about $RF=0.15$.

It must be observed that the result of gas reentering oil phase completely neglects non-equilibrium effects, e.g. compositional gradients, and must be used with care. For instance, it may be in strong disagreement with real reservoir behavior when gravity segregation is present.

Figure~\ref{fig: matbal_s} shows the formation of a free gas phase with growing $S_g$ and then its disappearance. Depending on the ratio of vertical and horizontal permeabilities or reservoir dip angle, it may also suggest the formation of a secondary gas cap.

Figure~\ref{fig: epsilon} shows the shape of residual function ($\epsilon$) with respect to pressure, i.e., holding all produced or injected volumes constant and allowing only pressure to change. Each different solid line corresponds to a different volume of fluid production and injection. The function root is the solution of material balance equation, Eq.~\eqref{eq: MBE_short}, and the non-differentiable point is the bubble-point pressure. Also, it is seen that function $\epsilon$ monotonically decreases with pressure, as theoretically shown before.

Figure~\ref{fig: iter} shows the count of newtonian iterations required to compute pressure with an accuracy within $0.001$ of initial bubble-point pressure. Typically, $12$ iterations are required.

Figure~\ref{fig: residual} shows the residual of numerical solution as defined in Eq.~\eqref{eq: residual}. Material balance error is less than $10^{-7}$ units of porous volume for all time steps.



\section{Conclusions}
\begin{enumerate}[1.]
\item Material balance equation can be obtained from black-oil equations under the assumptions of:
\begin{enumerate}[(a)]
\item mechanical equilibrium;
\item absence of gravity and capillary forces;
\item spatially constant bubble-point pressure or, equivalently, fluid saturations.
\end{enumerate}
\item One unique solution of pressure equation exists for a compressible system;
\item A residual function can be defined such that its root solves pressure equation. A numerical solution can be obtained with nonlinear root-finding algorithms.
\end{enumerate}

\section*{Nomenclature}
\begin{tabular}{ll}
$B_g$ & gas formation volume factor\\
$B_o$ & oil formation volume factor\\
$B_w$ & water formation volume factor\\
$R_s$ & solubility ratio of gas in oil phase\\
$S_g$ & gas saturation \\
$S_o$ & oil saturation \\
$S_w$ & water saturation \\
$G_p$ & produced volume of gas \\
$m$ & ratio of original free gas volume to original oil phase volume in reservoir conditions \\
$N$ & original volume of oil in place \\
$N_p$ & produced volume of oil \\
$P_b$ & bubble-point pressure \\
$V_p$ & porous volume \\
$W_i$ & injected volume of water \\
$W_p$ & produced volume of water
\end{tabular}
\section*{References}
\bibliographystyle{elsarticle-harv}
\bibliography{refs}
\cite{*}

\section*{Highlights}
\begin{enumerate}[1.]
\item The existing link between black-oil and material balance equation is examined in detail.
\item It is shown that gravity and capillary forces must be neglected and saturations must be constant in space so one can integrate black-oil equations in reservoir volume and obtain material balance equation.
\item Material balance equation are shown to have a unique solution for a compressible system.
\item Material balance equation are formulated for a variable bubble-point and they are used to a reservoir under pressure maintenance.
\end{enumerate}

\pagebreak

\begin{figure}
\centering
\includegraphics[width=\linewidth]{./python/matbal_p}
\caption{Reservoir pressure and bubble-point pressure as functions of recovery factor. Once depletion goes below bubble-point, pressure is hardly recovered for a saturated reservoir because of high system compressibility. Pressure is here given in units of the original bubble-point pressure.}
\label{fig: matbal_p}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=\linewidth]{./python/matbal_water}
\caption{Volume of water production and injection and aquifer influx.}
\label{fig: matbal_water}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=\linewidth]{./python/matbal_gas}
\caption{Volume of gas production.}
\label{fig: matbal_gas}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=\linewidth]{./python/matbal_S}
\caption{Phase saturations. Gas saturation is reduced as water injection progresses.}
\label{fig: matbal_s}
\end{figure}


\begin{figure}
\centering
\includegraphics[width=\linewidth]{./python/matbal_res}
\caption{Shape of residual function ($\varepsilon$). Each curve corresponds to different volumes of production and injection. Residual function monotonically decreases with pressure and it has no derivative at the bubble-point.}
\label{fig: epsilon}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=\linewidth]{./python/matbal_iter}
\caption{Count of newtonian iterations required to compute pressure with accuracy within $0.001$ units of initial bubble-point presure.}
\label{fig: iter}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=\linewidth]{./python/matbal_residual}
\caption{Residual of numerical solution in units of porous volume.}
\label{fig: residual}
\end{figure}

\begin{table*}
\small
\centering
\begin{tabular}{ll}
\toprule
\multicolumn{2}{l}{\textit{Material balance equation}}\\
\midrule
pressure & $F_p - F_i= N E_o + mN E_g + W E_w +C$ \\
\midrule
\multicolumn{2}{l}{\textit{Phase saturations}}\\
\midrule
oil & $S_{o2} = \left(N-N_p\right) B_{o2}/V_{p2}$ \label{eq: oiltab}
\\
water & $S_{w2} = \left(W+W_i+W_e-W_p\right) B_{w2}/V_{p2}$\\
gas & $S_{g2}=\left\lbrace N\left[\left(R_{s1}-R_{s2}\right)+m B_{o1}/B_{g1}\right]+N_p R_{s2}+G_i-G_p\right\rbrace Bg_2/V_{p2}$ \\
\midrule
\multicolumn{2}{l}{\textit{List of terms}} \\
\midrule
fluid production & $F_p=N_p \left[B_{o2} + \left(G_p/N_p -R_{s2}\right)B_{g2}\right]+W_p B_{w2}$ \\
fluid injection and influx & $F_i=\left(W_i +W_e\right) B_{w2}+G_{i}B_{g2}$ \\
fluid expansion & $E=N E_o + mN E_g + W E_w$ \\
oil phase expansion & $E_o=\left(B_{o2}-B_{o1}\right) - \left(R_{so2}-R_{so1}\right)B_{g2}$ \\
gas phase expansion & $E_g = B_{o1}\left(B_{g2}/B_{g1}-1\right)$ \\
water volume expansion & $E_w = B_{w2}-B_{w1}$\\
porous volume contraction & $C=V_{p2}- V_{p1}$\\
bubble-point pressure & $R_{s2}\left(P_b\right) = \left[N\left(m B_{1}/B_{g1} +R_{s1}\right)+G_i-G_p\right]/\left(N-N_p\right)$ \\ \bottomrule
\end{tabular}
\caption{Complete set of material balance equations.}
\label{tab: MBE}
\end{table*}

% % %
% Calcular derivada da função resíduo com relação à pressão.
% % %

\end{document}
